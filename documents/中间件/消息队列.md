[toc]

# 场景

- 异步处理
- 应用解耦
- 流量削峰
- 日志处理
- 消息通讯
- **分布式事务**

# 消息队列对比

| 消息中间件 | 性能 | 消息持久化 | 活跃度 | 优点 | 缺点 |
| ---------- | ---- | ---------- | ---------- | ---- | ---- |
| Apache Kafka | 百万级 | 是                        | 高         | 分布式、高吞吐量、可扩展、故障容错                             | 配置和运维相对复杂；对Zookeeper强依赖；多副本机制对带宽要求高             |
| RocketMQ     | 十万级       | 是                        | 中等       | 模型简单、接口易用 | 社区支持不如Kafka和RabbitMQ |
| RabbitMQ     | 12000+   | 是                        | 高         | 支持多种消息协议、易于使用管理界面、成熟稳定                    | 不支持动态扩展           |
| ActiveMQ     | 6000+   | 是                        | 中等       | 成熟 | 社区支持不如Kafka和RabbitMQ                     |

# AMQP

应用层标准高级消息队列协议，`Advanced Message Queuing Protocol`。

## 背景

各个厂家使用的`MQ`使用不同的`api`、协议，如果应用需要使用不同的厂家的队列，那么将增加系统复杂性。

为了解决这个问题，Java曾经试图使用JMS来屏蔽这些问题，类似JDBC。

但是消息中间件接口的复杂程度不得不引入新的消息通信标准化方案——`AMQP`。

## 基本概念

| 概念          | 意义                                                         |
| ------------- | ------------------------------------------------------------ |
| Server/Broker | 实现`AMQP`的服务器实体                                       |
| Connection    | 应用程序与Broker的网络连接                                   |
| Channel       | 信道，进行消息读写的通道，客户端可以建立多个Channel，每个Channel代表一个会话任务 |
| Message       | 消息                                                         |
| Exchange      | 交换机，用于接收消息。                                       |
| Binding       | Exchange与Queue之间的虚拟连接                                |
| Routing key   | 一个虚拟地址，个人理解为转发时所使用的映射关系中的key        |
| Queue         | 消息队列，用于缓存消息并转发给消费者                         |
| Virtual Host  | 类似权限控制组，一个Virtual Host中里面可以有若干个Exchange和Queue |
